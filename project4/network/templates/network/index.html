{% extends "network/layout.html" %}

{% block head %}
	<script type="text/javascript">
		function unlike(element){
			element.firstChild.classList.remove("fas");
			element.firstChild.classList.add("far");
			element.firstChild.classList.add("neutral-link");
			element.firstChild.classList.remove("light-accent");
			element.onclick= function() {
				like(element);
			}
			let post_id = parseInt(element.parentElement.previousElementSibling.innerHTML);
			console.log(post_id);

			//Update database with new like
		    fetch(`post/${post_id}`, {
		      method: 'PUT',
		      body: JSON.stringify({
		          liked: false
		      })
		    })	//Display the new like count, asynchronously, sequenced after updating the DB is done
	        .then(function(){
	        	fetch(`post/${post_id}`)
				// Put response into json form
				.then(response => response.json())
				.then(data => {
					likes_count = data.likes.length;
					console.log(likes_count);
					element.nextElementSibling.innerHTML = likes_count;
				});
			});
		}

		function like(element){
			element.firstChild.classList.remove("far");
			element.firstChild.classList.add("fas");
			element.firstChild.classList.add("light-accent");
			element.firstChild.classList.remove("neutral-link");
			element.onclick= function() {
				unlike(element);
			}
			//Get post based on post id
			let post_id = parseInt(element.parentElement.previousElementSibling.innerHTML);

			//Update database with new like
	        fetch(`post/${post_id}`, {
	          method: 'PUT',
	          body: JSON.stringify({
	              liked: true
	          })
	        })	//Display the new like count, asynchronously, sequenced after updating the DB is done
	       	.then(function(event){
	        	fetch(`post/${post_id}`)
				// Put response into json form
				.then(response => response.json())
				.then(data => {
					likes_count = data.likes.length;
					element.nextElementSibling.innerHTML = likes_count;
				});
			});
		}

	</script>
{% endblock %}


{% block body %}
    {% for post in posts %}
    	<div class="mt-3 mx-2 px-5 card profile-border background-color neutral-color">
			<div style="font-size: 20px" class="card-body">
				<h3 class="card-title text-center light-accent">Posted by <strong> {{ post.username }}</strong></h3>
				<h6 class="mb-2 card-subtitle text-center text-muted"> {{post.date}} </h6>
				<p> {{post.content}} </p>
				<p style="display: none"> {{post.id}} </p>
				<div class="mt-2 text-center mb-n2">
					{% if user in post.likes.all %} 
						<a onclick="unlike(this)"><i class="light-accent fas fa-heart mr-1"></i></a>
					{% else %}
						<a onclick="like(this)"><i class="neutral-link far fa-heart mr-1"></i></a> 
					{% endif %} 
					<span> {{post.likes.count}} </span>
				</div>
			</div>
		</div>
    {% empty %}
    	<h3 class="text-center light-accent"> There are currently no posts </h3>
    {% endfor %}
{% endblock %}